<html lang="en">

<head>
    <!--custom css-->
    <link href="/stylesheets/style.css" rel="stylesheet">

    <script>
        bpmAvg = 0;
        std_deviation = 0;
        var duration = 10;
        var count = 0;
        var msecsFirst = 0;
        var msecsPrevious = 0;
        var alternate = false;
        var rotate = 0;

        var intervals = [];

        var imageOn;
        var imageOff;

        function loadImages(){
            imageOn = new Image();
            imageOn.src ="/images/on3.png";
            imageOff = new Image();
            imageOff.src ="/images/off3.png";
        }

        function TapForBPM(e) {
//            document.getElementById("key_pressed").innerHTML = String.fromCharCode(e.which)

            timeSeconds = new Date;
            msecs = timeSeconds.getTime();

//            $("#switch2").fadeIn();
//            $("#switch2").fadeOut(1000);

            document.getElementById("switch").src = imageOn.src;
            setTimeout(function () {
                document.getElementById("switch").src = imageOff.src;
            }, 100);

//            if (alternate) {
//                document.getElementById("switch").src = "/images/off3.png"
////                document.getElementById("switch").src = "/images/off.png"
//                alternate = false
//            } else {
//                document.getElementById("switch").src = "/images/on3.png"
////                document.getElementById("switch").src = "/images/on.png"
//                alternate = true
//            }

//            switch (rotate) {
//                case 0:
//                    document.getElementById("switch").src = "/images/wheel2.png";
//                    rotate = 1;
//                    break;
//                case 1:
//                    document.getElementById("switch").src = "/images/wheel3.png";
//                    rotate = 2;
//                    break;
//                case 2:
//                    document.getElementById("switch").src = "/images/wheel4.png";
//                    rotate = 3;
//                    break;
//                case 3:
//                    document.getElementById("switch").src = "/images/wheel5.png";
//                    rotate = 4;
//                    break;
//                case 4:
//                    document.getElementById("switch").src = "/images/wheel1.png";
//                    rotate = 0;
//                    break;
//            }


            if (count == 0) {
                startTimer();
                msecsFirst = msecs;
                count = 1;
            } else {
                bpmAvg = 60000 * count / (msecs - msecsFirst);
                count++;
//                document.getElementById("bpm_avg").innerHTML = Math.round(bpmAvg * 100) / 100;
//                document.TAP_DISPLAY.T_WHOLE.value = Math.round(bpmAvg);
//                document.TAP_DISPLAY.T_TAP.value = count;
                intervals.push(msecs - msecsPrevious);
            }

            msecsPrevious = msecs;

            return true;
        }

        document.onkeypress = TapForBPM;
        //        var touchArea = document.getElementById("switch");
        //        touchArea.addEventListener("mousedown", TapForBPM, false);
        //        touchArea.addEventListener("touchstart", TapForBPM, false);

        //        document.getElementById("switch").onmousedown = TapForBPM;
        //        document.getElementById("switch").ontouchstart = TapForBPM;


        function progress(timeleft, timetotal, $element) {
            var progressBarWidth = $element.width() - ((timeleft - 1) / timetotal * $element.width());
            $element.find('div').animate({width: progressBarWidth}, 1000, "linear");
            if (timeleft > 1) {
                setTimeout(function () {
                    progress(timeleft - 1, timetotal, $element);
                }, 1000);
            } else {
                setTimeout(function () {
//                    window.alert(intervals + ", " + Math.round(standardDeviation(intervals)));
                    std_deviation = standardDeviation(intervals);
                    load_feedback();
                    postResult();
//                    experimentFinished();
                }, 1000);
            }
        };

        function startTimer() {
            $('#progressBar').width =
                progress(duration, duration, $('#progressBar'));
        }

        function experimentFinished() {
        }

        function standardDeviation(numbersArr) {
            //--CALCULATE AVAREGE--
            var total = 0;
            for (var key in numbersArr)
                total += numbersArr[key];
            var meanVal = total / numbersArr.length;
            //--CALCULATE AVAREGE--

            //--CALCULATE STANDARD DEVIATION--
            var SDprep = 0;
            for (var key in numbersArr)
                SDprep += Math.pow((parseFloat(numbersArr[key]) - meanVal), 2);
            var SDresult = Math.sqrt(SDprep / numbersArr.length);
            //--CALCULATE STANDARD DEVIATION--
//            alert(SDresult);
            return SDresult;
        }

        $(document).ready(function () {
            loadImages();
        })

    </script>
</head>

<body>
<h1 class="display-4">Experiment</h1>
<p class="lead">Cras justo odio, dapibus ac facilisis in, egestas eget quam. Fusce dapibus, tellus ac cursus commodo,
    tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>

<br>
<!--<div align="center" style="width:250px; height:250px; background: greenyellow" >-->
<!--<img id="switch" src="/images/off3.png" style="width:250px; height:250px; position: absolute; top: 0%">-->
<!--<img id="switch2" src="/images/on3.png" style="width:250px; height:250px; position: absolute">-->
<!--&lt;!&ndash;<img id="switch" src="/images/off3.png" style="width:250px;">&ndash;&gt;-->
<!--&lt;!&ndash;style="width:250px; height:250px; background: greenyellow"&ndash;&gt;-->
<!--</div>-->

<!--<div style="position: relative; left: 0; top: 0;">-->
<!--<img id="switch" src="/images/off.png" style="width:100px" onclick="TapForBPM()">-->
<!--<img id="switch" src="/images/off3.png" style="width:250px;" onclick="TapForBPM()">-->
<!--<img id="switch" src="/images/off3.png" style="width:250px;" onmousedown="TapForBPM()">-->
<img id="switch" src="/images/off3.png" style="width:250px;" ontouchend="" ontouchstart="TapForBPM()" onmousedown="TapForBPM()" >
<!--<img id="switch" src="/images/off3.png" style="width:250px;" onkeydown="TapForBPM()">-->
<!--<img id="switch" src="/images/wheel1.png" style="width:150px" onclick="TapForBPM()">-->

<br>
<br>
<br>


<!--<br>-->
<!--<p>KEY PRESSED:-->
<!--<font id="key_pressed" color="FF0000">none</font>-->
<!--</p>-->

<!--<p>BPM AVERAGE:-->
<!--<font id="bpm_avg" color="FF0000">none</font>-->
<!--</p>-->
<!--<br>-->


<div id="progressBar">
    <div style="width: 0"></div>
</div>
<br>

<!--<p><a class="btn btn-lg btn-success" href="#" role="button" onclick="start()">Weiter</a></p>-->
<!--<p><a class="btn btn-lg btn-success" href="#" role="button" onclick="load_feedback()">Weiter</a></p>-->
</body>
</html>